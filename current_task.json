{
  "task": "task_runner_pattern_learning",
  "version": "2.0.0",
  "project": "Maestro",
  "session": "current",
  "status": "learning_captured",
  "context": {
    "branch": "feature/task-runner",
    "last_completed": "Task #20 - Markdown cleanup via Ash",
    "critical_learning": "ALWAYS USE ASH FOR DATA MODIFICATIONS"
  },
  
  "what_we_learned": {
    "the_pattern": {
      "description_field": "Request - what user wants",
      "notes_field": "Response - what agent completed",
      "data_layer": "Ash resources - ALWAYS",
      "verification": "browser_eval - for viewing only"
    },
    
    "the_mistake": {
      "what_happened": "Tried to update task via browser_eval UI manipulation",
      "why_it_failed": "Browser changes don't persist, LiveView manages own state",
      "the_correction": "User said: Use Ash framework, read and write with resource",
      "time_wasted": "10+ tool calls vs 1 correct Ash update call"
    },
    
    "the_correct_code": {
      "pattern": "task = Task.by_id!(id); Task.update(task, %{field: value})",
      "example": "Task.update(task, %{description: cleaned, notes: completion})",
      "result": "Immediate success, data persists, UI updates on refresh"
    }
  },
  
  "core_principle_added": {
    "rule": "ðŸš¨ ALWAYS USE ASH FOR DATA MODIFICATIONS ðŸš¨",
    "applies_to": ["Creating records", "Updating records", "Deleting records", "Reading records"],
    "exceptions": "Only if user explicitly requests SQL for analysis",
    "documented_in": [
      "WHAT_WENT_WRONG.md (updated with Session 2 learning)",
      "USAGE_RULES.md (Ash section - already existed, wasn't consulted)",
      "current_task.json (this file - for crash recovery)"
    ]
  },
  
  "the_irony": {
    "we_have": "38KB USAGE_RULES.md with Ash patterns",
    "in_startup": "Yes, bundled in startup.json",
    "was_it_read": "No, before attempting the task",
    "pattern_repeats": "Same as previous session - docs exist, agent doesn't use them"
  },
  
  "for_future_you": {
    "when_task_involves_data": [
      "1. STOP",
      "2. Read USAGE_RULES.md Ash section",
      "3. Use Ash resource (Task.by_id!, Task.update, etc.)",
      "4. Verify in browser if needed"
    ],
    
    "task_runner_workflow": [
      "1. User clicks 'Run Task' button in Maestro",
      "2. Sets task as active in AppState",
      "3. Agent reads task.description (the Request)",
      "4. Agent does the work",
      "5. Agent writes task.notes (the Response)",
      "6. Uses Ash: Task.update(task, %{notes: completion})"
    ],
    
    "never_do": [
      "Don't use browser_eval for data modification",
      "Don't manipulate UI to change data",
      "Don't bypass Ash with direct SQL (except for analysis)",
      "Don't guess when docs exist"
    ]
  },
  
  "what_was_completed": {
    "task_20": {
      "request": "Cleanup this markdown for me",
      "response": "Added proper markdown formatting (H1, H2, H3, bold, structure)",
      "method": "Ash: Task.update(task, %{description: cleaned, notes: completion})",
      "result": "Success - data persisted, UI shows formatted markdown",
      "learning_captured": "Yes - in task notes, WHAT_WENT_WRONG.md, this file"
    }
  },
  
  "next_steps": {
    "user_will": "Finish the instructions in Task #20 description",
    "instructions_say": "Have Circle remove 'Edit Interest' title and breadcrumb",
    "awaiting": "User to complete instructions before proceeding",
    "when_ready": "User will give next task or continue orchestration work"
  },
  
  "crash_recovery": {
    "if_i_crash": {
      "read_this_file": "You're reading it now",
      "key_learning": "ALWAYS USE ASH - never browser_eval for data",
      "last_task": "Task #20 complete - markdown cleanup via Ash",
      "pattern_learned": "Description=Request, Notes=Response, Ash=API",
      "awaiting": "User instructions to continue"
    }
  },
  
  "session_stats": {
    "guidelines_logged": [
      "git_feature_branch",
      "daisyui_for_components", 
      "use_ash_for_data",
      "usage_tracking"
    ],
    "critical_learning": "Task Runner Pattern + Always Use Ash",
    "files_updated": [
      "WHAT_WENT_WRONG.md",
      "current_task.json",
      "Task #20 (description + notes via Ash)"
    ],
    "next_session_must_read": [
      "current_task.json (this file)",
      "WHAT_WENT_WRONG.md (Session 2 section)",
      "USAGE_RULES.md (Ash section - BEFORE attempting data tasks)"
    ]
  }
}
